<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafeRestore - Data Recovery</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: #000000;
      min-height: 100vh;
      color: #ffffff;
      overflow-x: hidden;
    }
    
    .bg-effects {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }
    
    .bg-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(100px);
      opacity: 0.4;
      animation: float 8s ease-in-out infinite;
    }
    
    .bg-orb-1 {
      width: 400px;
      height: 400px;
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      top: -100px;
      left: -100px;
      animation-delay: 0s;
    }
    
    .bg-orb-2 {
      width: 300px;
      height: 300px;
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      bottom: -50px;
      right: -50px;
      animation-delay: 2s;
    }
    
    .bg-orb-3 {
      width: 250px;
      height: 250px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation-delay: 4s;
      opacity: 0.2;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-30px) scale(1.05); }
    }
    
    .container {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 24px;
    }
    
    .header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .logo {
      display: inline-flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }
    
    .logo-icon {
      position: relative;
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 40px rgba(59, 130, 246, 0.4);
    }
    
    .logo-icon svg {
      width: 32px;
      height: 32px;
      color: white;
    }
    
    .logo-text {
      font-size: 32px;
      font-weight: 800;
      background: linear-gradient(135deg, #ffffff 0%, #e0e7ff 50%, #c7d2fe 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      color: #9ca3af;
      font-size: 17px;
      font-weight: 400;
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      background: rgba(255, 255, 255, 0.03);
      padding: 8px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .tab {
      flex: 1;
      padding: 14px 20px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: #9ca3af;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .tab:hover {
      color: #ffffff;
      background: rgba(255, 255, 255, 0.05);
    }
    
    .tab.active {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
    }
    
    .tab.active.android {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
    }
    
    .tab.active.mac-pc {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
    }
    
    .tab svg {
      width: 20px;
      height: 20px;
    }
    
    /* Tab Content */
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Scan Section */
    .scan-section {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 24px;
      padding: 40px;
      margin-bottom: 32px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(20px);
    }
    
    .scan-btn {
      width: 100%;
      padding: 20px 32px;
      font-size: 18px;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 14px;
      box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
    }
    
    .scan-btn:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 0 50px rgba(59, 130, 246, 0.5);
    }
    
    .scan-btn.android {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      box-shadow: 0 0 30px rgba(34, 197, 94, 0.3);
    }
    
    .scan-btn.android:hover {
      box-shadow: 0 0 50px rgba(34, 197, 94, 0.5);
    }
    
    .scan-btn.mac-pc {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
    }
    
    .scan-btn.mac-pc:hover {
      box-shadow: 0 0 50px rgba(139, 92, 246, 0.5);
    }
    
    .scan-btn.cloud {
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      box-shadow: 0 0 30px rgba(14, 165, 233, 0.3);
    }
    
    .scan-btn.cloud:hover {
      box-shadow: 0 0 50px rgba(14, 165, 233, 0.5);
    }
    
    .tab.cloud.active {
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      border-color: transparent;
      color: white;
    }
    
    .cloud-service-card {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s;
    }
    
    .cloud-service-card:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(14, 165, 233, 0.3);
    }
    
    .cloud-service-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .cloud-service-icon {
      width: 52px;
      height: 52px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .cloud-service-icon.google { background: linear-gradient(135deg, #ea4335 0%, #fbbc05 50%, #34a853 100%); }
    .cloud-service-icon.samsung { background: linear-gradient(135deg, #1428a0 0%, #0d47a1 100%); }
    .cloud-service-icon.apple { background: linear-gradient(135deg, #555 0%, #333 100%); }
    .cloud-service-icon.microsoft { background: linear-gradient(135deg, #00a4ef 0%, #7fba00 50%, #f25022 100%); }
    .cloud-service-icon.dropbox { background: linear-gradient(135deg, #0061ff 0%, #0040ab 100%); }
    
    .cloud-service-info h3 {
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 4px;
    }
    
    .cloud-service-info p {
      color: #9ca3af;
      font-size: 13px;
    }
    
    .cloud-service-features {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .cloud-feature-tag {
      background: rgba(14, 165, 233, 0.15);
      border: 1px solid rgba(14, 165, 233, 0.2);
      color: #7dd3fc;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .cloud-service-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .cloud-action-btn {
      padding: 12px 18px;
      background: rgba(14, 165, 233, 0.2);
      border: 1px solid rgba(14, 165, 233, 0.3);
      color: #7dd3fc;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .cloud-action-btn:hover {
      background: rgba(14, 165, 233, 0.3);
      border-color: rgba(14, 165, 233, 0.5);
    }
    
    .cloud-action-btn svg {
      width: 16px;
      height: 16px;
    }
    
    .local-sync-section {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.2);
      border-radius: 16px;
      padding: 20px;
      margin-top: 24px;
    }
    
    .local-sync-section h3 {
      color: #34d399;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .local-sync-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      margin-bottom: 10px;
    }
    
    .local-sync-item:last-child {
      margin-bottom: 0;
    }
    
    .sync-folder-icon {
      width: 40px;
      height: 40px;
      background: rgba(16, 185, 129, 0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .sync-folder-icon svg {
      width: 20px;
      height: 20px;
      color: #34d399;
    }
    
    .sync-folder-info {
      flex: 1;
    }
    
    .sync-folder-info h4 {
      color: #ffffff;
      font-size: 14px;
      font-weight: 600;
    }
    
    .sync-folder-info p {
      color: #6b7280;
      font-size: 12px;
    }
    
    .scan-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }
    
    .scan-btn svg {
      width: 24px;
      height: 24px;
    }
    
    .scan-btn .spinner {
      width: 24px;
      height: 24px;
      border: 3px solid rgba(255,255,255,0.2);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Info Box */
    .info-box {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 16px;
      padding: 20px 24px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #93c5fd;
      backdrop-filter: blur(10px);
    }
    
    .info-box.android {
      background: rgba(34, 197, 94, 0.1);
      border-color: rgba(34, 197, 94, 0.2);
      color: #86efac;
    }
    
    .info-box.mac-pc {
      background: rgba(139, 92, 246, 0.1);
      border-color: rgba(139, 92, 246, 0.2);
      color: #c4b5fd;
    }
    
    .info-box strong {
      color: #60a5fa;
    }
    
    .info-box.android strong {
      color: #4ade80;
    }
    
    .info-box.mac-pc strong {
      color: #a78bfa;
    }
    
    /* Pricing Badge */
    .pricing-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.15) 100%);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 12px;
      padding: 10px 16px;
      margin-top: 16px;
      font-size: 14px;
      color: #34d399;
    }
    
    .pricing-badge svg {
      width: 18px;
      height: 18px;
    }
    
    /* Backups List */
    .backups-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .backup-card {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    
    .backup-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .backup-card:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(59, 130, 246, 0.3);
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .backup-card:hover::before {
      opacity: 1;
    }
    
    .backup-header {
      display: flex;
      align-items: center;
      gap: 18px;
      margin-bottom: 16px;
      position: relative;
      z-index: 1;
    }
    
    .device-icon {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }
    
    .device-icon.android {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
    }
    
    .device-icon.mac-pc {
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      box-shadow: 0 8px 24px rgba(139, 92, 246, 0.3);
    }
    
    .device-icon svg {
      width: 28px;
      height: 28px;
      color: white;
    }
    
    .device-info {
      flex: 1;
    }
    
    .device-info h3 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #ffffff;
    }
    
    .device-info p {
      color: #9ca3af;
      font-size: 14px;
      font-weight: 500;
    }
    
    .encrypted-badge {
      background: rgba(245, 158, 11, 0.15);
      color: #fbbf24;
      padding: 8px 14px;
      border-radius: 24px;
      font-size: 12px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }
    
    .encrypted-badge svg {
      width: 14px;
      height: 14px;
    }
    
    .backup-meta {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #6b7280;
      font-size: 14px;
      font-weight: 500;
    }
    
    .meta-item svg {
      width: 18px;
      height: 18px;
      color: #4b5563;
    }
    
    /* No Backups State */
    .no-backups {
      text-align: center;
      padding: 80px 24px;
      color: #9ca3af;
    }
    
    .no-backups-icon {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
    }
    
    .no-backups-icon svg {
      width: 40px;
      height: 40px;
      color: #4b5563;
    }
    
    .no-backups h3 {
      font-size: 24px;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 12px;
    }
    
    .no-backups p {
      max-width: 400px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    /* Mac/PC Recovery Sections */
    .recovery-grid {
      display: grid;
      gap: 20px;
      margin-top: 24px;
    }
    
    .recovery-card {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 20px;
      padding: 28px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: all 0.3s;
    }
    
    .recovery-card:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(139, 92, 246, 0.3);
    }
    
    .recovery-card-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .recovery-card-icon {
      width: 52px;
      height: 52px;
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .recovery-card-icon svg {
      width: 26px;
      height: 26px;
      color: white;
    }
    
    .recovery-card h3 {
      font-size: 20px;
      font-weight: 700;
      color: #ffffff;
    }
    
    .recovery-card p {
      color: #9ca3af;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 20px;
    }
    
    .recovery-card-btn {
      padding: 14px 24px;
      background: rgba(139, 92, 246, 0.2);
      border: 1px solid rgba(139, 92, 246, 0.3);
      color: #a78bfa;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    
    .recovery-card-btn:hover {
      background: rgba(139, 92, 246, 0.3);
      border-color: rgba(139, 92, 246, 0.5);
      color: #c4b5fd;
    }
    
    .recovery-card-btn svg {
      width: 18px;
      height: 18px;
    }
    
    /* Trash Items */
    .trash-items {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding-right: 8px;
    }
    
    .trash-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .trash-item-icon {
      width: 44px;
      height: 44px;
      background: rgba(139, 92, 246, 0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .trash-item-icon svg {
      width: 22px;
      height: 22px;
      color: #a78bfa;
    }
    
    .trash-item-info {
      flex: 1;
    }
    
    .trash-item-info h4 {
      font-size: 15px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 4px;
      word-break: break-all;
    }
    
    .trash-item-info p {
      font-size: 13px;
      color: #6b7280;
    }
    
    .trash-item-restore {
      padding: 10px 16px;
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #34d399;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .trash-item-restore:hover {
      background: rgba(16, 185, 129, 0.3);
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: linear-gradient(180deg, #111827 0%, #0f172a 100%);
      border-radius: 24px;
      padding: 36px;
      max-width: 480px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 40px 80px rgba(0, 0, 0, 0.5);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
    }
    
    .modal-header h2 {
      font-size: 24px;
      font-weight: 700;
    }
    
    .close-btn {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.05);
      border: none;
      border-radius: 10px;
      color: #9ca3af;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .close-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      color: #ffffff;
    }
    
    .selected-device-box {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 14px;
      padding: 16px 20px;
      margin-bottom: 28px;
    }
    
    .selected-device-box strong {
      color: #60a5fa;
      font-size: 16px;
    }
    
    .selected-device-box p {
      color: #9ca3af;
      font-size: 13px;
      margin-top: 4px;
    }
    
    .section-label {
      color: #9ca3af;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 14px;
    }
    
    .data-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 28px;
    }
    
    .data-option {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 18px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .data-option:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(59, 130, 246, 0.3);
    }
    
    .data-option input {
      width: 20px;
      height: 20px;
      accent-color: #3b82f6;
      cursor: pointer;
    }
    
    .data-option label {
      flex: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      color: #e5e7eb;
    }
    
    .data-option svg {
      width: 20px;
      height: 20px;
      color: #6b7280;
    }
    
    .export-btn {
      width: 100%;
      padding: 18px;
      font-size: 17px;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
    }
    
    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 50px rgba(16, 185, 129, 0.5);
    }
    
    .export-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Status Messages */
    .status-message {
      text-align: center;
      padding: 18px 20px;
      border-radius: 14px;
      margin-top: 20px;
      font-weight: 500;
    }
    
    .status-message.success {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #34d399;
    }
    
    .status-message.error {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 32px 0;
      color: #4b5563;
      font-size: 13px;
    }
    
    .footer a {
      color: #6b7280;
      text-decoration: none;
      transition: color 0.2s;
    }
    
    .footer a:hover {
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <div class="bg-effects">
    <div class="bg-orb bg-orb-1"></div>
    <div class="bg-orb bg-orb-2"></div>
    <div class="bg-orb bg-orb-3"></div>
  </div>
  
  <div class="container">
    <div class="header">
      <div class="logo">
        <div class="logo-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
          </svg>
        </div>
        <span class="logo-text">SafeRestore</span>
      </div>
      <p class="subtitle">Recover photos, messages, and more from your backups</p>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('ios')" id="tab-ios">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
        </svg>
        iPhone & iPad
      </button>
      <button class="tab" onclick="switchTab('android')" id="tab-android">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17.6 9.48l1.84-3.18c.16-.31.04-.69-.26-.85-.29-.15-.65-.06-.83.22l-1.88 3.24a11.463 11.463 0 00-8.94 0L5.65 5.67c-.19-.29-.58-.38-.87-.2-.28.18-.37.54-.22.83L6.4 9.48A10.78 10.78 0 003 18h18a10.78 10.78 0 00-3.4-8.52zM7 15.25a1.25 1.25 0 110-2.5 1.25 1.25 0 010 2.5zm10 0a1.25 1.25 0 110-2.5 1.25 1.25 0 010 2.5z"/>
        </svg>
        Android
      </button>
      <button class="tab" onclick="switchTab('mac-pc')" id="tab-mac-pc">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25" />
        </svg>
        Mac / PC
      </button>
      <button class="tab" onclick="switchTab('cloud')" id="tab-cloud">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
        </svg>
        Cloud
      </button>
    </div>
    
    <!-- iOS Tab Content -->
    <div class="tab-content active" id="content-ios">
      <div class="info-box">
        <strong>How it works:</strong> SafeRestore scans your Mac for iTunes and Finder backups, then lets you extract photos, messages, contacts, notes, and call history safely and privately.
      </div>
      
      <div class="scan-section">
        <button class="scan-btn" id="scanBtn" onclick="scanForBackups()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
          <span>Scan for iPhone & iPad Backups</span>
        </button>
        
        <div class="pricing-badge">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>Free to scan. $29.99 per device recovery.</span>
        </div>
      </div>
      
      <div id="backupsList" class="backups-list"></div>
    </div>
    
    <!-- Android Tab Content -->
    <div class="tab-content" id="content-android">
      <div class="info-box android">
        <strong>Android Backups:</strong> SafeRestore scans for Samsung Smart Switch backups, ADB backups, and other Android backup files on your computer.
      </div>
      
      <div class="scan-section">
        <button class="scan-btn android" id="scanBtnAndroid" onclick="scanForAndroidBackups()">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
          </svg>
          <span>Scan for Android Backups</span>
        </button>
        
        <div class="pricing-badge">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>Free to scan. $29.99 per device recovery.</span>
        </div>
      </div>
      
      <div id="androidBackupsList" class="backups-list"></div>
    </div>
    
    <!-- Mac/PC Tab Content -->
    <div class="tab-content" id="content-mac-pc">
      <div class="info-box mac-pc">
        <strong>Computer Recovery:</strong> Recover files from Trash, access Time Machine backups, and restore accidentally deleted data from your Mac or PC.
      </div>
      
      <div class="recovery-grid">
        <!-- Trash Recovery -->
        <div class="recovery-card">
          <div class="recovery-card-header">
            <div class="recovery-card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
              </svg>
            </div>
            <h3>Trash / Recycle Bin</h3>
          </div>
          <p>Browse and restore recently deleted files from your computer's Trash. Files remain recoverable until you empty the Trash.</p>
          <button class="recovery-card-btn" onclick="scanTrash()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
            </svg>
            Scan Trash
          </button>
        </div>
        
        <!-- Time Machine -->
        <div class="recovery-card" id="timeMachineCard">
          <div class="recovery-card-header">
            <div class="recovery-card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h3>Time Machine (Mac)</h3>
          </div>
          <p>Access your Time Machine backups to restore files, folders, or entire system states from any previous backup point.</p>
          <button class="recovery-card-btn" onclick="openTimeMachine()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
            </svg>
            Open Time Machine
          </button>
        </div>
      </div>
      
      <div id="trashItems" class="backups-list" style="margin-top: 24px;"></div>
    </div>
    
    <!-- Cloud Tab Content -->
    <div class="tab-content" id="content-cloud">
      <div class="info-box" style="background: rgba(14, 165, 233, 0.1); border-color: rgba(14, 165, 233, 0.2); color: #7dd3fc;">
        <strong>Cloud Backups:</strong> Access your data from cloud services. We'll guide you through official export options for each service.
      </div>
      
      <div class="scan-section">
        <button class="scan-btn" id="scanBtnCloud" onclick="scanCloudServices()" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); box-shadow: 0 0 30px rgba(14, 165, 233, 0.3);">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
          </svg>
          <span>Check Cloud Services</span>
        </button>
      </div>
      
      <div id="cloudServicesList" class="recovery-grid" style="margin-top: 24px;"></div>
      
      <div id="localSyncFolders" style="margin-top: 24px;"></div>
    </div>
    
    <div class="footer">
      <p>Your data stays on your computer. 100% offline and private.</p>
      <p style="margin-top: 8px;"><a href="https://saferestorehelp.com/support">Need help?</a></p>
    </div>
  </div>
  
  <!-- Export Modal -->
  <div class="modal" id="exportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Export Data</h2>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>
      
      <div class="selected-device-box" id="selectedDeviceInfo">
        <strong id="selectedDeviceName"></strong>
        <p id="selectedDeviceDetails"></p>
      </div>
      
      <p class="section-label">Select data to recover</p>
      
      <div class="data-options">
        <div class="data-option">
          <input type="checkbox" id="opt-photos" checked>
          <label for="opt-photos">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
            </svg>
            Photos & Videos
          </label>
        </div>
        <div class="data-option">
          <input type="checkbox" id="opt-messages" checked>
          <label for="opt-messages">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
            </svg>
            Messages & iMessage
          </label>
        </div>
        <div class="data-option">
          <input type="checkbox" id="opt-contacts" checked>
          <label for="opt-contacts">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
            </svg>
            Contacts
          </label>
        </div>
        <div class="data-option">
          <input type="checkbox" id="opt-notes" checked>
          <label for="opt-notes">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
            </svg>
            Notes
          </label>
        </div>
        <div class="data-option">
          <input type="checkbox" id="opt-calls" checked>
          <label for="opt-calls">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
            </svg>
            Call History
          </label>
        </div>
      </div>
      
      <button class="export-btn" id="exportBtn" onclick="exportData()">
        <span id="exportBtnText">Recover Selected Data</span>
      </button>
      
      <div id="statusMessage"></div>
    </div>
  </div>
  
  <!-- Payment Modal -->
  <div class="modal" id="paymentModal">
    <div class="modal-content" style="max-width: 480px;">
      <div class="modal-header">
        <h2>Unlock Data Recovery</h2>
        <button class="close-btn" onclick="closePaymentModal()">&times;</button>
      </div>
      
      <div style="text-align: center; padding: 24px 0;">
        <div style="width: 80px; height: 80px; margin: 0 auto 20px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2" style="width: 40px; height: 40px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
          </svg>
        </div>
        
        <h3 style="font-size: 20px; margin-bottom: 12px;">Scanning is Free!</h3>
        <p style="color: #9ca3af; margin-bottom: 24px; line-height: 1.6;">
          To recover your data, you'll need to purchase a one-time recovery credit for this device.
        </p>
        
        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 24px;">
          <div style="font-size: 36px; font-weight: 700; color: #10b981;">$29.99</div>
          <div style="color: #9ca3af; font-size: 14px;">One-time payment per device</div>
        </div>
        
        <ul style="text-align: left; list-style: none; margin-bottom: 24px;">
          <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #d1d5db;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#10b981" stroke-width="2" style="width: 20px; height: 20px; flex-shrink: 0;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
            </svg>
            Export all your photos, messages & contacts
          </li>
          <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #d1d5db;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#10b981" stroke-width="2" style="width: 20px; height: 20px; flex-shrink: 0;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
            </svg>
            Unlimited exports for this device
          </li>
          <li style="display: flex; align-items: center; gap: 12px; color: #d1d5db;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="#10b981" stroke-width="2" style="width: 20px; height: 20px; flex-shrink: 0;">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
            </svg>
            Secure payment via Stripe
          </li>
        </ul>
        
        <button class="export-btn" id="purchaseBtn" onclick="startPurchase()" style="width: 100%;">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
          </svg>
          Purchase Recovery Credit
        </button>
        
        <p style="color: #6b7280; font-size: 12px; margin-top: 16px;">
          After payment, return to this app to complete your recovery.
        </p>
      </div>
    </div>
  </div>
  
  <script>
    let selectedBackup = null;
    let currentTab = 'ios';
    const API_BASE = 'https://saferestore.replit.app';
    
    // Generate a unique machine ID for this computer
    async function getMachineId() {
      // Use stored machine ID or generate new one
      let machineId = localStorage.getItem('safeRestore_machineId');
      if (!machineId) {
        // Generate a random ID for this machine
        machineId = 'mac_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
        localStorage.setItem('safeRestore_machineId', machineId);
      }
      return machineId;
    }
    
    // Generate a unique device ID from backup path
    function getDeviceId(backupPath) {
      // Create a simple hash of the backup path to identify this specific backup
      let hash = 0;
      for (let i = 0; i < backupPath.length; i++) {
        const char = backupPath.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      return 'dev_' + Math.abs(hash).toString(36);
    }
    
    // Check if user has a credit for this device
    async function checkCredit(machineId, deviceId) {
      try {
        const response = await fetch(`${API_BASE}/api/device/check-credit`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ machineId, deviceId })
        });
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error checking credit:', error);
        return { hasCredit: false, error: error.message };
      }
    }
    
    // Use credit when exporting
    async function useCredit(machineId, deviceId) {
      try {
        const response = await fetch(`${API_BASE}/api/device/use-credit`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ machineId, deviceId })
        });
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Error using credit:', error);
        return { success: false, error: error.message };
      }
    }
    
    // Show payment modal
    function showPaymentModal() {
      document.getElementById('paymentModal').classList.add('active');
    }
    
    // Close payment modal
    function closePaymentModal() {
      document.getElementById('paymentModal').classList.remove('active');
    }
    
    // Start purchase flow
    async function startPurchase() {
      if (!selectedBackup) return;
      
      const purchaseBtn = document.getElementById('purchaseBtn');
      purchaseBtn.disabled = true;
      purchaseBtn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;display:inline-block;margin-right:8px;"></div> Opening checkout...';
      
      try {
        const machineId = await getMachineId();
        const deviceId = getDeviceId(selectedBackup.path);
        
        const response = await fetch(`${API_BASE}/api/device/checkout`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            machineId, 
            deviceId,
            deviceName: selectedBackup.name 
          })
        });
        
        const data = await response.json();
        
        if (data.url) {
          // Store session info for verification after payment
          localStorage.setItem('safeRestore_pendingSession', JSON.stringify({
            sessionId: data.sessionId,
            machineId,
            deviceId,
            backupPath: selectedBackup.path,
            timestamp: Date.now()
          }));
          
          // Open payment URL in browser
          if (window.safeRestore && window.safeRestore.openExternal) {
            await window.safeRestore.openExternal(data.url);
          } else {
            window.open(data.url, '_blank');
          }
          
          closePaymentModal();
          closeModal();
          
          // Show message to user
          alert('Payment page opened in your browser. After completing payment, return to this app and try exporting again.');
        } else {
          throw new Error(data.error || 'Failed to create checkout');
        }
      } catch (error) {
        alert('Error starting purchase: ' + error.message);
      }
      
      purchaseBtn.disabled = false;
      purchaseBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
        </svg>
        Purchase Recovery Credit
      `;
    }
    
    // Check for pending purchase on app focus/load
    async function checkPendingPurchase() {
      const pendingStr = localStorage.getItem('safeRestore_pendingSession');
      if (!pendingStr) return;
      
      try {
        const pending = JSON.parse(pendingStr);
        
        // Only check if within last hour
        if (Date.now() - pending.timestamp > 3600000) {
          localStorage.removeItem('safeRestore_pendingSession');
          return;
        }
        
        // Verify the purchase
        const response = await fetch(`${API_BASE}/api/device/verify-purchase`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            sessionId: pending.sessionId,
            machineId: pending.machineId,
            deviceId: pending.deviceId
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          localStorage.removeItem('safeRestore_pendingSession');
          alert('Payment confirmed! You can now recover data from this device.');
        }
      } catch (error) {
        console.error('Error checking pending purchase:', error);
      }
    }
    
    // Check on load
    window.addEventListener('load', checkPendingPurchase);
    window.addEventListener('focus', checkPendingPurchase);
    
    function switchTab(tabName) {
      currentTab = tabName;
      
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active', 'android', 'mac-pc', 'cloud');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      const selectedTab = document.getElementById(`tab-${tabName}`);
      selectedTab.classList.add('active');
      if (tabName === 'android') selectedTab.classList.add('android');
      if (tabName === 'mac-pc') selectedTab.classList.add('mac-pc');
      if (tabName === 'cloud') selectedTab.classList.add('cloud');
      
      document.getElementById(`content-${tabName}`).classList.add('active');
    }
    
    async function scanForBackups() {
      const btn = document.getElementById('scanBtn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div><span>Scanning...</span>';
      
      try {
        const backups = await window.safeRestore.scanBackups();
        displayBackups(backups, 'ios');
      } catch (error) {
        console.error('Scan error:', error);
        showNoBackups('backupsList', 'ios', error.message);
      }
      
      btn.disabled = false;
      btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
        <span>Scan for iPhone & iPad Backups</span>
      `;
    }
    
    async function scanForAndroidBackups() {
      const btn = document.getElementById('scanBtnAndroid');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div><span>Scanning...</span>';
      
      try {
        const backups = await window.safeRestore.scanAndroidBackups();
        displayBackups(backups, 'android');
      } catch (error) {
        console.error('Android scan error:', error);
        showNoBackups('androidBackupsList', 'android', error.message);
      }
      
      btn.disabled = false;
      btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
        </svg>
        <span>Scan for Android Backups</span>
      `;
    }
    
    async function scanTrash() {
      try {
        const result = await window.safeRestore.scanTrash();
        displayTrashItems(result);
      } catch (error) {
        console.error('Trash scan error:', error);
        document.getElementById('trashItems').innerHTML = `
          <div class="no-backups">
            <h3>Could not scan Trash</h3>
            <p>${error.message || 'Please try again.'}</p>
          </div>
        `;
      }
    }
    
    async function openTimeMachine() {
      try {
        await window.safeRestore.openTimeMachine();
      } catch (error) {
        alert('Could not open Time Machine: ' + (error.message || 'Unknown error'));
      }
    }
    
    function displayTrashItems(result) {
      const container = document.getElementById('trashItems');
      
      if (!result.items || result.items.length === 0) {
        container.innerHTML = `
          <div class="no-backups">
            <div class="no-backups-icon">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h3>Trash is Empty</h3>
            <p>No deleted files found in your Trash.</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div style="margin-bottom: 16px; padding: 16px; background: rgba(139, 92, 246, 0.1); border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.2);">
          <p style="color: #c4b5fd; font-size: 14px;">
            <strong>${result.totalItems} items</strong> in Trash (${result.totalSize})
          </p>
        </div>
        <div class="trash-items">
          ${result.items.map(item => `
            <div class="trash-item">
              <div class="trash-item-icon">
                ${getTrashItemIcon(item.type)}
              </div>
              <div class="trash-item-info">
                <h4>${item.name}</h4>
                <p>${item.size}  Deleted ${formatDate(item.deletedDate)}</p>
              </div>
              <button class="trash-item-restore" onclick="restoreTrashItem('${item.path.replace(/'/g, "\\'")}')">
                Restore
              </button>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    function getTrashItemIcon(type) {
      const icons = {
        image: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>',
        video: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z" /></svg>',
        audio: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="m9 9 10.5-3m0 6.553v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 1 1-.99-3.467l2.31-.66a2.25 2.25 0 0 0 1.632-2.163Zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 0 1-1.632 2.163l-1.32.377a1.803 1.803 0 0 1-.99-3.467l2.31-.66A2.25 2.25 0 0 0 9 15.553Z" /></svg>',
        document: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>',
        folder: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" /></svg>',
        file: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg>',
      };
      return icons[type] || icons.file;
    }
    
    async function restoreTrashItem(filePath) {
      try {
        const destination = await window.safeRestore.selectExportFolder();
        if (!destination) return;
        
        const result = await window.safeRestore.restoreFromTrash(filePath, destination);
        if (result.success) {
          alert(`Restored "${result.fileName}" to ${destination}`);
          scanTrash();
        } else {
          alert('Could not restore file: ' + result.error);
        }
      } catch (error) {
        alert('Error restoring file: ' + error.message);
      }
    }
    
    function showNoBackups(containerId, type, errorMessage) {
      const container = document.getElementById(containerId);
      const typeLabel = type === 'ios' ? 'iPhone/iPad' : 'Android';
      
      container.innerHTML = `
        <div class="no-backups">
          <div class="no-backups-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
            </svg>
          </div>
          <h3>No ${typeLabel} Backups Found</h3>
          <p>${errorMessage || `We couldn't find any ${typeLabel} backups on this computer. Make sure you've backed up your device using ${type === 'ios' ? 'iTunes or Finder' : 'Samsung Smart Switch or ADB'}.`}</p>
        </div>
      `;
    }
    
    function displayBackups(backups, type) {
      const containerId = type === 'ios' ? 'backupsList' : 'androidBackupsList';
      const container = document.getElementById(containerId);
      
      if (backups.length === 0) {
        showNoBackups(containerId, type);
        return;
      }
      
      container.innerHTML = backups.map(backup => `
        <div class="backup-card" onclick="selectBackup('${backup.path.replace(/'/g, "\\'")}', '${backup.deviceName.replace(/'/g, "\\'")}', '${backup.deviceType}', '${type}')">
          <div class="backup-header">
            <div class="device-icon ${type === 'android' ? 'android' : ''}">
              ${getDeviceIconSVG(backup.deviceIcon)}
            </div>
            <div class="device-info">
              <h3>${backup.deviceName}</h3>
              <p>${backup.deviceType}${backup.backupType ? '  ' + backup.backupType : ''}</p>
            </div>
            ${backup.isEncrypted ? `
              <div class="encrypted-badge">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
                </svg>
                Encrypted
              </div>
            ` : ''}
          </div>
          <div class="backup-meta">
            <div class="meta-item">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
              </svg>
              ${formatDate(backup.lastBackup)}
            </div>
            <div class="meta-item">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
              </svg>
              ${backup.size}
            </div>
          </div>
        </div>
      `).join('');
    }
    
    function getDeviceIconSVG(type) {
      if (type === 'tablet') {
        return '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5h3m-6.75 2.25h10.5a2.25 2.25 0 002.25-2.25v-15a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 4.5v15a2.25 2.25 0 002.25 2.25z" /></svg>';
      }
      if (type === 'android') {
        return '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.6 9.48l1.84-3.18c.16-.31.04-.69-.26-.85-.29-.15-.65-.06-.83.22l-1.88 3.24a11.463 11.463 0 00-8.94 0L5.65 5.67c-.19-.29-.58-.38-.87-.2-.28.18-.37.54-.22.83L6.4 9.48A10.78 10.78 0 003 18h18a10.78 10.78 0 00-3.4-8.52zM7 15.25a1.25 1.25 0 110-2.5 1.25 1.25 0 010 2.5zm10 0a1.25 1.25 0 110-2.5 1.25 1.25 0 010 2.5z"/></svg>';
      }
      return '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" /></svg>';
    }
    
    function formatDate(date) {
      if (!date) return 'Unknown';
      const d = new Date(date);
      return d.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    function selectBackup(path, name, type, platform) {
      selectedBackup = { path, name, type, platform };
      document.getElementById('selectedDeviceName').textContent = name;
      document.getElementById('selectedDeviceDetails').textContent = type;
      document.getElementById('exportModal').classList.add('active');
      document.getElementById('statusMessage').innerHTML = '';
    }
    
    function closeModal() {
      document.getElementById('exportModal').classList.remove('active');
      selectedBackup = null;
    }
    
    async function exportData() {
      if (!selectedBackup) return;
      
      const exportBtn = document.getElementById('exportBtn');
      const statusMessage = document.getElementById('statusMessage');
      
      exportBtn.disabled = true;
      exportBtn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;display:inline-block;margin-right:8px;"></div> Checking license...';
      
      try {
        // PAYMENT GATE: Check if user has credit for this device
        const machineId = await getMachineId();
        const deviceId = getDeviceId(selectedBackup.path);
        
        const creditCheck = await checkCredit(machineId, deviceId);
        
        if (!creditCheck.hasCredit) {
          // No credit - show payment modal
          exportBtn.disabled = false;
          exportBtn.innerHTML = 'Recover Selected Data';
          showPaymentModal();
          return;
        }
        
        // Has credit - proceed with export
        exportBtn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;display:inline-block;margin-right:8px;"></div> Processing...';
        
        const exportPath = await window.safeRestore.selectExportFolder();
        if (!exportPath) {
          exportBtn.disabled = false;
          exportBtn.innerHTML = 'Recover Selected Data';
          return;
        }
        
        const dataTypes = {
          photos: document.getElementById('opt-photos').checked,
          messages: document.getElementById('opt-messages').checked,
          contacts: document.getElementById('opt-contacts').checked,
          notes: document.getElementById('opt-notes').checked,
          calls: document.getElementById('opt-calls').checked,
        };
        
        const result = await window.safeRestore.exportData(selectedBackup.path, exportPath, dataTypes);
        
        if (result.success) {
          // Log successful export (optional, doesn't affect future exports)
          useCredit(machineId, deviceId).catch(err => {
            console.warn('Could not log export activity:', err);
          });
          
          statusMessage.className = 'status-message success';
          statusMessage.innerHTML = `
            <strong>Recovery Complete!</strong><br>
            Your data has been exported to:<br>
            <code style="font-size: 12px; word-break: break-all;">${exportPath}</code>
          `;
          
          setTimeout(() => {
            window.safeRestore.openFolder(exportPath);
          }, 1000);
        } else {
          throw new Error(result.error || 'Export failed');
        }
      } catch (error) {
        statusMessage.className = 'status-message error';
        statusMessage.innerHTML = `<strong>Error:</strong> ${error.message}`;
      }
      
      exportBtn.disabled = false;
      exportBtn.innerHTML = 'Recover Selected Data';
    }
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
    
    // Cloud Services Functions
    async function scanCloudServices() {
      const btn = document.getElementById('scanBtnCloud');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner"></div><span>Checking...</span>';
      
      try {
        const status = await window.safeRestore.getCloudStatus();
        displayCloudServices(status);
      } catch (error) {
        console.error('Cloud scan error:', error);
        document.getElementById('cloudServicesList').innerHTML = `
          <div class="no-backups">
            <h3>Could not check cloud services</h3>
            <p>${error.message || 'Please try again.'}</p>
          </div>
        `;
      }
      
      btn.disabled = false;
      btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" />
        </svg>
        <span>Check Cloud Services</span>
      `;
    }
    
    function displayCloudServices(status) {
      const container = document.getElementById('cloudServicesList');
      const localContainer = document.getElementById('localSyncFolders');
      
      if (!status.success) {
        container.innerHTML = `
          <div class="no-backups">
            <h3>Could not load cloud services</h3>
            <p>${status.error || 'Please try again.'}</p>
          </div>
        `;
        return;
      }
      
      
      container.innerHTML = status.services.map(service => `
        <div class="cloud-service-card">
          <div class="cloud-service-header">
            <div class="cloud-service-icon ${service.id}">
              ${getCloudServiceIcon(service.id)}
            </div>
            <div class="cloud-service-info">
              <h3>${service.name}</h3>
              <p>${service.description}</p>
            </div>
          </div>
          <div class="cloud-service-features">
            ${service.features.map(f => `<span class="cloud-feature-tag">${f}</span>`).join('')}
          </div>
          <div class="cloud-service-actions">
            <button class="cloud-action-btn" onclick="openCloudService('${service.id}')">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
              </svg>
              Sign In
            </button>
            <button class="cloud-action-btn" onclick="openDataExport('${service.id}')">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
              </svg>
              Export Data
            </button>
            ${service.hasLocalSync ? `
              <button class="cloud-action-btn" onclick="browseLocalSync('${service.localFolder.path.replace(/'/g, "\\'")}')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                </svg>
                Browse Local
              </button>
            ` : ''}
          </div>
        </div>
      `).join('');
      
      // Display local sync folders if any
      if (status.localFolders && status.localFolders.length > 0) {
        localContainer.innerHTML = `
          <div class="local-sync-section">
            <h3>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Local Cloud Sync Folders Found
            </h3>
            ${status.localFolders.map(folder => `
              <div class="local-sync-item">
                <div class="sync-folder-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                  </svg>
                </div>
                <div class="sync-folder-info">
                  <h4>${folder.name}</h4>
                  <p>${folder.sizeFormatted} synced locally</p>
                </div>
                <button class="cloud-action-btn" onclick="browseLocalSync('${folder.path.replace(/'/g, "\\'")}')">
                  Open
                </button>
              </div>
            `).join('')}
          </div>
        `;
      } else {
        localContainer.innerHTML = '';
      }
    }
    
    function getCloudServiceIcon(serviceId) {
      const icons = {
        google: '<svg viewBox="0 0 24 24" fill="white" style="width:28px;height:28px"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>',
        samsung: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" style="width:28px;height:28px"><path d="M5 7h14v2H5zm0 4h14v2H5zm0 4h10v2H5z"/></svg>',
        icloud: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" style="width:28px;height:28px"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>',
        onedrive: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" style="width:28px;height:28px"><path d="M10.5 14.5l2-1 3.5 2L20 17l-2 1.5-5.5-1-2-3zm-3.5 3l3.5-2 2 3-3.5 2-2-3zm9.5-6.5l2-1 3 2.5L18 15l-1.5-4zm-8.5-1l3-2 3.5 3-4 2-2.5-3z"/></svg>',
        dropbox: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" style="width:28px;height:28px"><path d="M12 6.5L6 10l6 3.5L12 10 6 6.5zm0 0l6 3.5-6 3.5 6 3.5 6-3.5-6-3.5 6-3.5-6-3.5z"/></svg>'
      };
      const cloudFallbackIcon = '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2" style="width:28px;height:28px"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15a4.5 4.5 0 004.5 4.5H18a3.75 3.75 0 001.332-7.257 3 3 0 00-3.758-3.848 5.25 5.25 0 00-10.233 2.33A4.502 4.502 0 002.25 15z" /></svg>';
      return icons[serviceId] || cloudFallbackIcon;
    }
    
    async function openCloudService(serviceId) {
      try {
        await window.safeRestore.openCloudService(serviceId);
      } catch (error) {
        alert('Could not open service: ' + error.message);
      }
    }
    
    async function openDataExport(serviceId) {
      try {
        const result = await window.safeRestore.openDataExport(serviceId);
        if (result.success && result.steps) {
          alert('Export steps:\\n\\n' + result.steps.join('\\n'));
        }
      } catch (error) {
        alert('Could not open export page: ' + error.message);
      }
    }
    
    async function browseLocalSync(folderPath) {
      try {
        await window.safeRestore.openFolder(folderPath);
      } catch (error) {
        alert('Could not open folder: ' + error.message);
      }
    }
    
    // Android Extraction Functions
    async function selectAndroidBackup(path, name, type) {
      selectedBackup = { path, name, type, platform: 'android' };
      
      // Get detailed backup info
      try {
        const details = await window.safeRestore.getAndroidBackupDetails(path);
        if (details.success) {
          showAndroidExportModal(details, name);
        } else {
          alert('Could not read backup details: ' + details.error);
        }
      } catch (error) {
        alert('Error reading backup: ' + error.message);
      }
    }
    
    function showAndroidExportModal(details, deviceName) {
      document.getElementById('selectedDeviceName').textContent = deviceName;
      document.getElementById('selectedDeviceDetails').textContent = `${details.summary.photos} photos, ${details.summary.videos} videos, ${details.summary.contacts} contacts`;
      
      // Update checkboxes based on available data
      const opts = {
        photos: details.canExport.photos,
        messages: details.canExport.messages,
        contacts: details.canExport.contacts,
        notes: false,
        calls: details.canExport.callLogs
      };
      
      for (const [key, available] of Object.entries(opts)) {
        const checkbox = document.getElementById(`opt-${key}`);
        if (checkbox) {
          checkbox.checked = available;
          checkbox.disabled = !available;
        }
      }
      
      document.getElementById('exportModal').classList.add('active');
      document.getElementById('statusMessage').innerHTML = '';
    }
  </script>
</body>
</html>
